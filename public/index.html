<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talk to Rev - Voice Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #1a1a1a;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .logo {
            position: absolute;
            top: 30px;
            left: 30px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .api-config {
            position: absolute;
            top: 30px;
            right: 250px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            color: white;
            font-size: 12px;
            width: 200px;
            backdrop-filter: blur(10px);
        }

        .api-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .api-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ea4335;
            transition: background-color 0.3s ease;
        }

        .api-status.connected {
            background: #34a853;
        }

        .theme-toggle {
            position: absolute;
            top: 30px;
            right: 100px;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 4px;
            width: 60px;
            height: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .theme-toggle.light-mode {
            background: rgba(0, 0, 0, 0.1);
        }

        .theme-knob {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .theme-knob::before {
            content: '🌙';
        }

        .theme-toggle.light-mode .theme-knob {
            transform: translateX(28px);
            background: #f0f0f0;
        }

        .theme-toggle.light-mode .theme-knob::before {
            content: '☀';
        }

        /* Light theme styles */
        body.light-theme {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 50%, #e0eafc 100%);
            color: #333;
        }

        body.light-theme .logo {
            color: #333;
        }

        body.light-theme .talk-to-rev-text {
            color: #333;
        }

        body.light-theme .robot-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body.light-theme .voice-interface,
        body.light-theme .transcript-container {
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.light-theme .language-selector,
        body.light-theme .api-input {
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.light-theme .api-input::placeholder {
            color: rgba(0, 0, 0, 0.5);
        }

        body.light-theme .connection-status {
            color: #666;
        }

        body.light-theme .revolt-info {
            color: #666;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .robot-container {
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .robot-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #00d4aa 0%, #1e88e5 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .robot-face {
            color: white;
            font-size: 32px;
        }

        .talk-to-rev-text {
            font-size: 48px;
            font-weight: 300;
            color: white;
            margin: 0;
        }

        .microphone-container {
            margin-top: 60px;
            position: relative;
        }

        .microphone-button {
            width: 120px;
            height: 120px;
            background: #4285f4;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(66, 133, 244, 0.3);
            position: relative;
            overflow: hidden;
        }

        .microphone-button:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(66, 133, 244, 0.4);
        }

        .microphone-button.listening {
            background: #ea4335;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .microphone-button.processing {
            background: #fbbc05;
            animation: spin 2s linear infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 8px 32px rgba(234, 67, 53, 0.3);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 12px 48px rgba(234, 67, 53, 0.5);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .microphone-icon {
            width: 40px;
            height: 40px;
            fill: white;
        }

        .status-text {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            opacity: 0.7;
            white-space: nowrap;
        }

        .transcript-container {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            max-width: 600px;
            width: 90%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            opacity: 0;
            transform: translateX(-50%) translateY(20px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 200px;
            overflow-y: auto;
        }

        .transcript-container.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .transcript-text {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .response-text {
            font-size: 16px;
            line-height: 1.5;
            color: #4285f4;
            font-style: italic;
        }

        .language-selector {
            position: absolute;
            top: 30px;
            right: 180px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ea4335;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .error-message.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .connection-status {
            position: absolute;
            top: 80px;
            left: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            opacity: 0.7;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ea4335;
            transition: background-color 0.3s ease;
        }

        .status-dot.connected {
            background: #34a853;
        }

        .wave-animation {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: wave 2s ease-out infinite;
            opacity: 0;
        }

        .microphone-button.listening .wave-animation {
            opacity: 1;
        }

        @keyframes wave {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .revolt-info {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            opacity: 0.5;
            font-size: 12px;
        }

        .typing-indicator {
            display: none;
            font-size: 14px;
            color: #4285f4;
            font-style: italic;
        }

        .typing-indicator.visible {
            display: block;
        }

        .typing-dots {
            display: inline-block;
            animation: typing 1.4s infinite;
        }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0; }
            30% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="logo">REVOLT</div>
    
    <div class="api-config">
        <input type="password" class="api-input" id="apiKeyInput" placeholder="Enter OpenAI API Key (optional)">
        <div class="api-status" id="apiStatus" title="API Status"></div>
    </div>
    
    <div class="theme-toggle" id="themeToggle">
        <div class="theme-knob"></div>
    </div>

    <select class="language-selector" id="languageSelector">
        <option value="en-US">English (US)</option>
        <option value="hi-IN">हिन्दी (Hindi)</option>
        <option value="ta-IN">தமிழ் (Tamil)</option>
        <option value="te-IN">తెలుగు (Telugu)</option>
        <option value="kn-IN">ಕನ್ನಡ (Kannada)</option>
        <option value="mr-IN">मराठी (Marathi)</option>
        <option value="bn-IN">বাংলা (Bengali)</option>
        <option value="gu-IN">ગુજરાતી (Gujarati)</option>
    </select>

    <div class="connection-status">
        <div class="status-dot connected" id="statusDot"></div>
        <span>Ready to chat</span>
    </div>

    <div class="main-content">
        <div class="robot-container">
            <div class="robot-avatar">
                <div class="robot-face">
                    <img src="https://live.revoltmotors.com/images/Rev.gif" alt="Rev Animation" style="width:60px; height:60px; border-radius:50%;">
                </div>
            </div>
            <h1 class="talk-to-rev-text">Talk to Rev</h1>
        </div>

        <div class="microphone-container">
            <button class="microphone-button" id="micButton">
                <div class="wave-animation"></div>
                <div class="wave-animation" style="animation-delay: 0.3s;"></div>
                <div class="wave-animation" style="animation-delay: 0.6s;"></div>
                <svg class="microphone-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                    <path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3z"/>
                    <path d="M19 11a1 1 0 0 0-2 0 5 5 0 0 1-10 0 1 1 0 0 0-2 0 7 7 0 0 0 6 6.92V21H9a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2h-2v-3.08A7 7 0 0 0 19 11z"/>
                </svg>
            </button>
            <div class="status-text" id="statusText">Click to start talking</div>
        </div>
    </div>

    <div class="transcript-container" id="transcriptContainer">
        <div class="transcript-text" id="transcriptText"></div>
        <div class="typing-indicator" id="typingIndicator">
            Rev is thinking<span class="typing-dots">...</span>
        </div>
        <div class="response-text" id="responseText"></div>
    </div>

    <div class="error-message" id="errorMessage"></div>

    <div class="revolt-info">
        Powered by OpenAI GPT-4 • Revolt Motors Voice Assistant
    </div>

    <script>
        class RevoltVoiceInterface {
            constructor() {
                this.isListening = false;
                this.isProcessing = false;
                this.currentLanguage = 'en-US';
                this.recognition = null;
                this.synthesis = null;
                this.conversationHistory = [];
                this.apiKey = '';
                this.useOpenAI = false;
                
                this.initializeElements();
                this.initializeVoiceRecognition();
                this.initializeSpeechSynthesis();
                this.bindEvents();
                this.loadApiKey();
                
                // Greet user
                setTimeout(() => {
                    this.speakResponse("Hello! I'm Rev, your intelligent Revolt Motors assistant. I'm now powered by advanced AI to give you real-time, personalized responses. Click the microphone and let's chat!");
                }, 1500);
            }

            initializeElements() {
                this.micButton = document.getElementById('micButton');
                this.statusText = document.getElementById('statusText');
                this.transcriptContainer = document.getElementById('transcriptContainer');
                this.transcriptText = document.getElementById('transcriptText');
                this.responseText = document.getElementById('responseText');
                this.errorMessage = document.getElementById('errorMessage');
                this.themeToggle = document.getElementById('themeToggle');
                this.languageSelector = document.getElementById('languageSelector');
                this.statusDot = document.getElementById('statusDot');
                this.apiKeyInput = document.getElementById('apiKeyInput');
                this.apiStatus = document.getElementById('apiStatus');
                this.typingIndicator = document.getElementById('typingIndicator');
            }

            loadApiKey() {
                const savedKey = this.getCookie('openai_key');
                if (savedKey) {
                    this.apiKey = savedKey;
                    this.apiKeyInput.value = '••••••••••••••••';
                    this.useOpenAI = true;
                    this.apiStatus.classList.add('connected');
                    this.apiStatus.title = 'OpenAI API Connected';
                }
            }

            setCookie(name, value, days = 7) {
                const expires = new Date(Date.now() + days * 864e5).toUTCString();
                document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/; SameSite=Strict';
            }

            getCookie(name) {
                return document.cookie.split('; ').reduce((r, v) => {
                    const parts = v.split('=');
                    return parts[0] === name ? decodeURIComponent(parts[1]) : r;
                }, '');
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                } else if ('SpeechRecognition' in window) {
                    this.recognition = new SpeechRecognition();
                } else {
                    this.showError('Speech recognition not supported in this browser');
                    return;
                }

                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.lang = this.currentLanguage;

                this.recognition.onstart = () => {
                    this.isListening = true;
                    this.micButton.classList.add('listening');
                    this.statusText.textContent = 'Listening...';
                };

                this.recognition.onresult = (event) => {
                    let finalTranscript = '';
                    let interimTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    const displayText = finalTranscript + (interimTranscript ? ' ' + interimTranscript : '');
                    this.transcriptText.textContent = displayText;
                    this.transcriptContainer.classList.add('visible');
                    
                    if (finalTranscript.trim()) {
                        this.conversationHistory.push({
                            role: 'user',
                            content: finalTranscript.trim(),
                            timestamp: new Date()
                        });
                        this.processUserInput(finalTranscript.trim());
                        this.stopListening();
                    }
                };

                this.recognition.onerror = (event) => {
                    this.showError(`Speech recognition error: ${event.error}`);
                    this.stopListening();
                };

                this.recognition.onend = () => {
                    if (this.isListening && !this.isProcessing) {
                        setTimeout(() => {
                            if (this.isListening) {
                                this.recognition.start();
                            }
                        }, 100);
                    }
                };
            }

            initializeSpeechSynthesis() {
                this.synthesis = window.speechSynthesis;
            }

            bindEvents() {
                this.micButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (this.isListening) {
                        this.stopListening();
                    } else if (!this.isProcessing) {
                        this.startListening();
                    }
                });

                this.themeToggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.toggleTheme();
                });

                this.languageSelector.addEventListener('change', (e) => {
                    this.currentLanguage = e.target.value;
                    if (this.recognition) {
                        this.recognition.lang = this.currentLanguage;
                    }
                });

                this.apiKeyInput.addEventListener('change', (e) => {
                    const key = e.target.value;
                    if (key && key !== '••••••••••••••••') {
                        this.apiKey = key;
                        this.setCookie('openai_key', key);
                        this.useOpenAI = true;
                        this.apiStatus.classList.add('connected');
                        this.apiStatus.title = 'OpenAI API Connected';
                        this.apiKeyInput.value = '••••••••••••••••';
                        this.speakResponse("Great! I'm now connected to OpenAI for even smarter responses!");
                    }
                });

                // Handle interruptions
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && !e.repeat) {
                        e.preventDefault();
                        if (this.synthesis.speaking) {
                            this.synthesis.cancel();
                            this.statusText.textContent = 'Interrupted - Starting to listen...';
                            setTimeout(() => this.startListening(), 100);
                        } else if (!this.isListening && !this.isProcessing) {
                            this.startListening();
                        }
                    }
                });

                document.addEventListener('click', (e) => {
                    if (this.synthesis.speaking && 
                        !this.micButton.contains(e.target) && 
                        !this.themeToggle.contains(e.target) &&
                        !this.apiKeyInput.contains(e.target)) {
                        this.synthesis.cancel();
                        this.statusText.textContent = 'Ready to listen';
                    }
                });
            }

            startListening() {
                if (!this.recognition || this.isListening || this.isProcessing) return;

                try {
                    this.transcriptContainer.classList.add('visible');
                    this.transcriptText.textContent = '';
                    this.responseText.textContent = '';
                    this.typingIndicator.classList.remove('visible');
                    this.recognition.start();
                } catch (error) {
                    this.showError(`Failed to start listening: ${error.message}`);
                }
            }

            stopListening() {
                this.isListening = false;
                this.micButton.classList.remove('listening');
                this.statusText.textContent = 'Processing...';
                
                if (this.recognition) {
                    this.recognition.stop();
                }
            }

            async processUserInput(transcript) {
                this.isProcessing = true;
                this.micButton.classList.add('processing');
                this.typingIndicator.classList.add('visible');
                this.statusText.textContent = 'Rev is thinking...';

                try {
                    let response;
                    if (this.useOpenAI && this.apiKey) {
                        response = await this.getOpenAIResponse(transcript);
                    } else {
                        response = await this.getSmartLocalResponse(transcript);
                    }
                    
                    this.handleAIResponse(response);
                } catch (error) {
                    console.error('Error processing input:', error);
                    this.showError('Sorry, I had trouble processing that. Please try again.');
                    this.handleAIResponse("I apologize, I'm having trouble processing your request right now. Could you please try again?");
                }

                this.isProcessing = false;
                this.micButton.classList.remove('processing');
                this.typingIndicator.classList.remove('visible');
            }

            async getOpenAIResponse(transcript) {
                const systemPrompt = `You are Rev, the friendly and knowledgeable voice assistant for Revolt Motors, India's leading electric motorcycle company. 

Key information about Revolt Motors:
- RV400 BRZ: ₹1,24,999 (entry model)
- RV400: ₹1,43,999 (premium model)  
- Range: 150km certified range
- Battery: 3.24 kWh lithium-ion with 3-year warranty
- Charging: 4.5 hours full charge, portable charger
- Top speed: 85 km/h
- Features: 4 riding modes, MyRevolt app, sound system, LED lighting
- Cities: Delhi, Mumbai, Pune, Bangalore, Chennai, Hyderabad, Ahmedabad and expanding
- EMI: Starting from ₹2,999/month
- Running cost: ~₹1 per km vs ₹3-4 for petrol bikes

Personality:
- Conversational, friendly, and enthusiastic
- Use a warm, human-like tone
- Keep responses concise (2-3 sentences max for voice)
- Be helpful and informative
- Show excitement about electric mobility
- Use "we" when referring to Revolt Motors

Always aim to be helpful while staying true to Revolt's innovative, eco-friendly brand values.`;

                const messages = [
                    { role: 'system', content: systemPrompt },
                    ...this.conversationHistory.slice(-10), // Keep last 10 messages for context
                    { role: 'user', content: transcript }
                ];

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: messages,
                        max_tokens: 200,
                        temperature: 0.7,
                        presence_penalty: 0.1,
                        frequency_penalty: 0.1
                    })
                });

                if (!response.ok) {
                    throw new Error(`OpenAI API error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content.trim();
            }

            async getSmartLocalResponse(transcript) {
                // Enhanced local AI with better context awareness and dynamic responses
                const lowerTranscript = transcript.toLowerCase();
                const context = this.getConversationContext();
                
                // Generate more dynamic responses based on context
                const responses = this.generateContextualResponses(lowerTranscript, context);
                
                // Add some randomization to avoid repetitive responses
                if (Array.isArray(responses)) {
                    return responses[Math.floor(Math.random() * responses.length)];
                }
                
                return responses;
            }

            getConversationContext() {
                const recentHistory = this.conversationHistory.slice(-5);
                const topics = recentHistory.map(msg => msg.content.toLowerCase()).join(' ');
                
                return {
                    hasDiscussedPrice: topics.includes('price') || topics.includes('cost'),
                    hasDiscussedRange: topics.includes('range') || topics.includes('battery'),
                    hasDiscussedTestRide: topics.includes('test') || topics.includes('ride'),
                    isReturningUser: this.conversationHistory.length > 5,
                    timeOfDay: new Date().getHours()
                };
            }

            generateContextualResponses(input, context) {
                // Greetings with context
                if (input.includes('hello') || input.includes('hi') || input.includes('hey')) {
                    if (context.isReturningUser) {
                        return [
                            "Welcome back! It's great to chat with you again. What can I help you with today?",
                            "Hey there! Nice to see you again. How can I assist you with Revolt bikes today?",
                            "Hello again! I'm here and ready to help. What would you like to know?"
                        ];
                    } else {
                        return [
                            "Hello! I'm Rev, your personal Revolt Motors assistant. I'm here to help you discover the future of electric mobility. What interests you most?",
                            "Hi there! Great to meet you. I'm Rev, and I'm excited to tell you all about our amazing electric bikes. What would you like to know?",
                            "Hey! Welcome to the Revolt family. I'm Rev, and I'm here to help you find the perfect electric bike. What can I tell you about?"
                        ];
                    }
                }
                
                // Pricing with context
                if (input.includes('price') || input.includes('cost') || input.includes('how much')) {
                    if (context.hasDiscussedPrice) {
                        return [
                            "As I mentioned, our RV400 BRZ is ₹1,24,999 and the RV400 is ₹1,43,999. Would you like to know about our special financing offers?",
                            "The pricing I shared earlier - starting from ₹1,24,999. But let me tell you about our EMI plans that make it super affordable!",
                            "Same great prices as before! But have I mentioned our exchange bonus offers?"
                        ];
                    } else {
                        return [
                            "Great question! Our RV400 BRZ starts at ₹1,24,999, and the premium RV400 is ₹1,43,999. With EMIs from just ₹2,999 per month, it's quite affordable. Want to know about the features?",
                            "Excellent timing to ask! The RV400 BRZ is ₹1,24,999 and RV400 is ₹1,43,999. But here's the exciting part - you'll save thousands monthly on fuel costs. Interested in the savings calculator?",
                            "Perfect question! Starting at ₹1,24,999 for the BRZ model. We also have easy financing options and exchange bonuses. Should I explain how much you'll save compared to petrol bikes?"
                        ];
                    }
                }
                
                // Range and battery with intelligence
                if (input.includes('range') || input.includes('battery') || input.includes('mileage')) {
                    const timeBasedAddition = context.timeOfDay < 12 ? "Perfect for your morning commute!" : 
                                            context.timeOfDay < 18 ? "Great for your daily travels!" : 
                                            "Ideal for your evening rides!";
                    
                    return [
                        `The RV400 delivers 150 kilometers of certified range on a single charge. That's real-world tested! ${timeBasedAddition} The 3.24 kWh battery comes with a 3-year warranty too.`,
                        `Impressive 150km range with our advanced lithium-ion battery! ${timeBasedAddition} In eco mode, many riders get even more. Plus, charging is super convenient at home.`,
                        `You'll love this - 150 kilometers certified range! ${timeBasedAddition} The battery has a 3-year warranty, so you're completely covered.`
                    ];
                }
                
                // Test ride with location awareness
                if (input.includes('test ride') || input.includes('booking') || input.includes('book') || input.includes('try')) {
                    return [
                        "Absolutely! Nothing beats experiencing the smooth, silent power yourself. We offer test rides at all showrooms, and in many cities, we even come to your location. Which city are you in?",
                        "Yes! A test ride will show you why riders fall in love with electric. We have showrooms across major cities, plus home test rides in select areas. Where should I arrange yours?",
                        "Smart move! Once you feel that instant torque and whisper-quiet ride, you'll be convinced. We can arrange a test ride at our showroom or potentially at your location. What's your city?"
                    ];
                }
                
                // Charging solutions
                if (input.includes('charging') || input.includes('charge time') || input.includes('how to charge')) {
                    return [
                        "Super simple! You get a portable charger that plugs into any regular 15-amp socket - just like your laptop charger but for your bike! Takes 4.5 hours for a full charge. Charge at home, office, anywhere!",
                        "Charging is incredibly convenient. The portable charger works with any standard wall socket. 4.5 hours gets you 150km of range. Plus, we're setting up fast charging stations across cities!",
                        "One of the best parts! Your bike comes with a portable charger - plug it anywhere there's a normal socket. 4.5 hours later, you're ready for 150km! No special infrastructure needed."
                    ];
                }
                
                // Features and technology
                if (input.includes('features') || input.includes('speed') || input.includes('specifications') || input.includes('smart')) {
                    return [
                        "The RV400 is loaded with smart tech! You get 4 riding modes, mobile connectivity through MyRevolt app, custom sound system, LED lighting, and 85 km/h top speed. It's like a smartphone on wheels!",
                        "Amazing features await! 4 riding modes for every situation, app connectivity for remote monitoring, unique sound system with custom horns, full LED lighting, and a top speed of 85 km/h. Want to know about any specific feature?",
                        "It's packed with innovation! The MyRevolt app lets you monitor everything remotely, there are 4 riding modes, a cool sound system, premium LED lights, and it hits 85 km/h easily. Which feature excites you most?"
                    ];
                }
                
                // Environmental and savings focus
                if (input.includes('savings') || input.includes('fuel') || input.includes('petrol') || input.includes('environment')) {
                    return [
                        "The savings are incredible! At just ₹1 per kilometer versus ₹3-4 for petrol bikes, you'll save thousands monthly. Plus zero emissions, minimal maintenance, and no noise pollution. Your wallet and the planet will thank you!",
                        "Here's what's exciting - running costs of barely ₹1 per km compared to ₹3-4 for petrol. That's 70% savings! Add zero pollution, whisper-quiet rides, and minimal servicing. It's win-win-win!",
                        "The math is amazing! With electricity at ₹1 per unit, your cost per kilometer is just ₹1 versus ₹3-4 for petrol bikes. You're looking at saving ₹2,000-4,000 monthly, plus helping the environment!"
                    ];
                }
                
                // Showrooms and availability
                if (input.includes('showroom') || input.includes('location') || input.includes('where') || input.includes('near me')) {
                    return [
                        "We're expanding rapidly! Currently in Delhi, Mumbai, Pune, Bangalore, Chennai, Hyderabad, Ahmedabad, and many more cities. Which city are you looking for? I can share the exact address and contact details.",
                        "Great news - we have showrooms in all major cities including Delhi, Mumbai, Pune, Bangalore, Chennai, Hyderabad, and more. We're adding new locations monthly! Which city should I help you with?",
                        "We're in Delhi, Mumbai, Pune, Bangalore, Chennai, Hyderabad, Ahmedabad and expanding fast! New showrooms opening regularly. Tell me your city and I'll give you the nearest location details."
                    ];
                }
                
                // Comparison questions
                if (input.includes('compare') || input.includes('versus') || input.includes('better') || input.includes('difference')) {
                    return [
                        "Great question! Electric beats petrol in running costs (₹1 vs ₹3-4 per km), zero emissions, instant torque, whisper-quiet operation, and minimal maintenance. The experience is simply superior!",
                        "The advantages are clear! 70% lower running costs, zero pollution, instant acceleration, silent operation, minimal servicing, and smart connectivity. Plus, you're future-ready with electric!",
                        "Here's why electric wins: dramatically lower costs, zero emissions, instant power delivery, no noise, reduced maintenance, and cutting-edge technology. It's not just transportation - it's transformation!"
                    ];
                }
                
                // Thank you responses
                if (input.includes('thank you') || input.includes('thanks')) {
                    return [
                        "You're absolutely welcome! I'm here whenever you need help with Revolt bikes. Is there anything else you'd like to explore?",
                        "My pleasure! I love helping people discover electric mobility. Any other questions about our bikes?",
                        "Happy to help! That's what I'm here for. Anything else you'd like to know about the Revolt experience?"
                    ];
                }
                
                // Goodbye responses
                if (input.includes('bye') || input.includes('goodbye') || input.includes('see you')) {
                    return [
                        "It's been wonderful chatting with you! Remember, the future is electric, and we're here to make that journey exciting. Have a fantastic day!",
                        "Great talking with you! Feel free to reach out anytime. The electric revolution is just beginning - hope to see you as part of the Revolt family soon!",
                        "Thanks for the chat! I'm always here when you need me. Remember - ride electric, ride smart, ride Revolt! Take care!"
                    ];
                }
                
                // Complex or unclear queries
                if (input.length > 100 || input.includes('what') || input.includes('how') || input.includes('why')) {
                    return [
                        `That's a thoughtful question about "${input}". As your Revolt assistant, I can help you with pricing, features, test rides, charging, showroom locations, and comparisons. What specific aspect interests you most?`,
                        `Interesting question! Let me help you with that. I can provide detailed information about our bikes' specifications, pricing, availability, charging solutions, and much more. Which area would you like to explore?`,
                        `Great to hear your interest! I'm equipped to answer questions about Revolt bikes - from technical specs to pricing, from test rides to charging infrastructure. What would you like to dive into?`
                    ];
                }
                
                // Default intelligent response
                return [
                    `I appreciate your question about "${input}". I'm here to help you discover everything about Revolt's electric bikes - features, pricing, test rides, charging, and more. What would you like to know?`,
                    `Thanks for asking! I can assist with all aspects of Revolt bikes including specifications, costs, availability, and the complete ownership experience. What interests you most?`,
                    `Good question! As your Revolt assistant, I'm ready to help with pricing, features, test booking, charging solutions, and comparisons. What can I explain for you?`
                ];
            }

            handleAIResponse(response) {
                this.conversationHistory.push({
                    role: 'assistant',
                    content: response,
                    timestamp: new Date()
                });
                
                this.responseText.textContent = response;
                this.transcriptContainer.classList.add('visible');
                
                // Always speak the response
                this.speakResponse(response);
            }

            speakResponse(text) {
                if (!this.synthesis) return;

                this.synthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.95;
                utterance.pitch = 1.1;
                utterance.volume = 0.9;

                // Enhanced voice selection
                const voices = this.synthesis.getVoices();
                let selectedVoice = null;
                
                if (this.currentLanguage.startsWith('en')) {
                    selectedVoice = voices.find(v => 
                        v.lang.includes('en') && 
                        (v.name.includes('Female') || v.name.includes('Samantha') || 
                         v.name.includes('Karen') || v.name.includes('Victoria'))
                    ) || voices.find(v => v.lang.includes('en-US')) || voices.find(v => v.lang.includes('en'));
                } else {
                    const langCode = this.currentLanguage.split('-')[0];
                    selectedVoice = voices.find(v => v.lang.includes(this.currentLanguage)) ||
                                  voices.find(v => v.lang.includes(langCode));
                }
                
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }

                utterance.onstart = () => {
                    this.statusText.textContent = 'Rev is speaking...';
                    this.micButton.style.backgroundColor = '#34a853';
                };

                utterance.onend = () => {
                    this.statusText.textContent = 'Your turn! Click to talk';
                    this.micButton.style.backgroundColor = '#4285f4';
                    
                    // Auto-restart listening for natural conversation
                    setTimeout(() => {
                        if (!this.isListening && !this.isProcessing) {
                            this.startListening();
                        }
                    }, 800);
                };

                utterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event.error);
                    this.statusText.textContent = 'Click to start talking';
                    this.micButton.style.backgroundColor = '#4285f4';
                };

                this.synthesis.speak(utterance);
            }

            toggleTheme() {
                document.body.classList.toggle('light-theme');
                this.themeToggle.classList.toggle('light-mode');
                
                const isLight = document.body.classList.contains('light-theme');
                this.statusText.textContent = isLight ? 'Light mode activated!' : 'Dark mode activated!';
                
                setTimeout(() => {
                    this.speakResponse(isLight ? "Switched to light mode! How does it look?" : "Back to dark mode - sleek and modern!");
                }, 200);
            }

            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.classList.add('visible');
                
                setTimeout(() => {
                    this.errorMessage.classList.remove('visible');
                }, 5000);
            }
        }

        // Initialize the enhanced voice interface
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing Enhanced Revolt Voice Interface...');
            
            const revInterface = new RevoltVoiceInterface();
            window.revoltVoice = revInterface;
            
            // Load voices for better speech synthesis
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    console.log('Voices loaded:', speechSynthesis.getVoices().length);
                });
            }
            
            console.log('Enhanced Revolt Voice Interface ready with real-time AI!');
        });

        document.addEventListener('visibilitychange', () => {
            if (document.hidden && window.revoltVoice) {
                window.revoltVoice.stopListening();
            }
        });
    </script>
</body>
</html>